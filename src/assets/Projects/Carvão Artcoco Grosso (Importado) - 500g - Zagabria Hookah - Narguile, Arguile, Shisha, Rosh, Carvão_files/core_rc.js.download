var _cartstack=_cartstack||[];var cs_call=false;var cs_event='capture';var cs_debug=cs_debug||false;var cs_pro=cs_pro||false;var cs_pro_hit=cs_pro_hit||false;var cs_api_host='https://api2.cartstack.com.br';var cs_cart_limit=10;var cs_api_urls={purchase:cs_api_host+'/br/v1/purchase/',cart:cs_api_host+'/br/v1/cart/',cart_update:cs_api_host+'/br/v1/cart/update/',browse:cs_api_host+'/br/v1/browse/'};var dmregExp=/([a-z\-0-9]{2,63})\.([a-z\.]{2,6})$/;function cs_cartItems(){var b=0;if("undefined"!=typeof _cartstack)
for(var a=0;a<_cartstack.length;a++)"setCartItem"==_cartstack[a][0]&&b++;return b}
function cs_cartItemsLimit(arr){cs_cart_limit=xe_isset(cs_cart_limit,'number')?cs_cart_limit:10;var b=0;var rem=[];arr=("undefined"==typeof arr)?_cartstack:arr;for(var a=0;a<arr.length;a++){if("setCartItem"==arr[a][0]){b++;b>cs_cart_limit&&rem.push(a);}}
if(rem.length>0){for(var a=0;a<rem.length;a++)
arr.splice(rem[a],1);}
return arr;}
function cs_browseItemsDup(arr){var b=0;var rem=[];arr=("undefined"==typeof arr)?_cartstack_pro:arr;if("undefined"!=typeof arr){for(var a=0;a<arr.length;a++){if("setBrowseItem"==arr[a][0]){b++;b>10&&rem.push(a);}}
if(rem.length>0){for(var a=0;a<rem.length;a++)
arr.splice(rem[a],1);}}
return arr;}
function cs_apiRequestData(type,log){log=(typeof log==='undefined')?false:log;var res=false;if(log){var now=Math.round((new Date()).getTime()/1000);localStorage.setItem('cartstack-api_'+type,String(log)+','+String(now));res=true;}else{var s=localStorage.getItem('cartstack-api_'+type);if(s!==null){s=s.split(',');return s;}}
return res;}
function cs_apiRequestDiff(type,interval){var s=cs_apiRequestData(type);var res=false;if(Array.isArray(s)){var ts=parseInt(s[1]);var now=Math.round((new Date()).getTime()/1000);var diff=now-ts;switch(interval){case 'seconds':res=Math.floor(diff);break;case 'minutes':res=Math.floor(diff/60);break;case 'hours':res=Math.floor(diff/60/60);break;case 'days':res=Math.floor(diff/60/60/24);break;case 'months':res=Math.floor(diff/60/60/24/30);break;}}
return res;}
function cs_validRequest(type,len){var s=cs_apiRequestData(type);var res=true;if(Array.isArray(s)){res=(parseInt(s[0])!==len)?true:false;}
res&&cs_apiRequestData(type,len);return res;}
function cs_fullUTMURL(arr,utm){arr=('undefined'==typeof arr)?_cartstack:arr;utm=('undefined'==typeof utm||'object'!=typeof utm)?{source:'CartStack',medium:'Email',campaign:'CarrinhoAbandonado'}:utm;var url=window.location.href;var part='utm_source='+utm.source+'&utm_medium='+utm.medium+'&utm_campaign='+utm.campaign;var _arr=[];for(var key in xe_urlp){if(xe_urlp.hasOwnProperty(key)){_arr.push(key+'='+xe_urlp[key]);}}
if(_arr.length>0)
part=part+'&'+_arr.join('&');part=(url.indexOf('#')>-1&&part.indexOf('#')==-1)?part+'#'+url.split('#')[1]:part;url=url.split('?')[0]+'?'+part;var added=false;for(var a=0;a<arr.length;a++){added=(added||("setDataItem"==arr[a][0]&&typeof arr[a][1]=='object'&&typeof arr[a][1].FullURL=='string'))?true:false;}
if(!added){arr.push(['setDataItem',{'FullURL':url}]);}
return url;}
function cartstack_getCookie(t){return xe_readCookie(t.split('=')[0],true);}
function cs_lgpdRestrict(){var lgpd_restrict=(xe_core.requireExtension('lgpd'))?xe_core.callService('cookieConsent'):'';lgpd_restrict=(lgpd_restrict==='DENY'||(lgpd_restrict!=''&&lgpd_restrict.indexOf('EMAIL_MARKETING')==-1))?true:false;if(!lgpd_restrict){_cartstack.push(['xe_visitorID',String(xe_core.callService('visitorInfo').id)]);if(xe_core.vm){_cartstack.push(['xe_vm',xe_core.vm]);}
_cartstack.push(['xe_DGUID',String(xe_config.GUID)]);if(typeof performaConfig==='object'&&performaConfig.hasOwnProperty('status')&&performaConfig.status==='ok'&&performaConfig.hasOwnProperty('details')){_cartstack.push(['pfmPowerCart',performaConfig.details.modules.powercart]);}}
return lgpd_restrict;}
function csAPICall(type,callback){if(cs_lgpdRestrict()){return false;}
cs_cartItemsLimit();var payload=window.btoa(encodeURIComponent(JSON.stringify(_cartstack)));if(cs_validRequest(type,payload.length)){var x=new XMLHttpRequest;if(x.open("GET",cs_api_urls[[type]]+'?payload='+payload,!0),x.onreadystatechange=function(){if(4==x.readyState){if(200==x.status){var t=(x.responseText.indexOf('{"')>-1)?JSON.parse(x.responseText):false;(t!==false&&typeof callback=='function')?callback(t,200):callback(false,200);}else
(typeof callback=='function')&&callback(false,x.status);}},x.send(null));}else{cs_debug&&console.log("[CartStack] Core - @csAPICall("+type+"), Request already sent!");}}
function cartstackCall(){if(cs_call){return false;}
cs_call=true;cs_debug&&console.log("[CartStack] Core - @cartstackCall();");var t=/^([A-Za-z0-9_\-\.])+@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;if("undefined"!=typeof _cartstack&&!cartstack_confirmation){var e="",a=0,r=window.location.href;(r.indexOf("cartstacktest=true")>-1)&&(a=1,_cartstack.push(["setShowAlert",1]));for(var c=0,s=0,i="",o="",n="",d="",l=0;l<_cartstack.length;l++){var m=_cartstack[l][0],p=_cartstack[l][1];"setAPI"==m&&"capture"==p&&(s=1),"setAPI"==m&&"confirmation"==p&&(cartstack_confirmation=1),"setAPI"==m&&"tracking"==p&&(c=1),"setEmail"==m&&(i=p),"setSiteID"==m&&(o=p),"setEmailAddressInput"==m&&(n=p),"setDomain"==m&&(d=p),"setCartID"==m&&(e=p)}
if(0==d.length){var parts;var d=window.location.hostname;if((parts=dmregExp.exec(d))!==null){if(parts.index===dmregExp.lastIndex)
dmregExp.lastIndex++;d=(!parts[0]||parts[0]=='undefined')?-1:String(parts[0]);}}
if(navigator.cookieEnabled===!0){var k=r.indexOf("cs_e_id=");if(k>-1){k+=8;var g=r.indexOf("&",k);i=g>-1?r.substring(k,g):r.substring(k),i=decodeURIComponent(i)}
if(r.indexOf("_cscid=")>-1){var f;f=r.split("_cscid=")[1],e=f.indexOf("&")>-1?f.split("&")[0]:f}
var eml=xe_core.callService('visitorInfo').email,cid=xe_readCookie('cartstack.com-cartid');if(isNaN(cid)){cid='';xe_deleteCookie('cartstack.com-cartid');}
if(s&&!c){cs_event='capture';cs_debug&&console.log('[CartStack] Core - Event: Capture');}else
if(cartstack_confirmation){cs_event='confirmation';cs_debug&&console.log("[CartStack] Core - Event: Confirmation");if(eml!=''){for(var A=1,B=1,l=0;l<_cartstack.length;l++){"setEmail"==_cartstack[l][0]&&(_cartstack[l][1]=eml,A=0);"setCartID"==_cartstack[l][0]&&(_cartstack[l][1]=cid,B=0);}
A&&_cartstack.push(["setEmail",eml]);(B&&cid!='')&&_cartstack.push(["setCartID",cid]);csAPICall('purchase',function(json,httpcode){if(httpcode==200){xe_deleteCookie('cartstack.com-cartid');cs_debug&&console.log('[CartStack] Core - @csAPICall(purchase), Email removed from queue!');}else
cs_debug&&console.log('[CartStack] Core - @csAPICall(purchase), API Failed!');});}}else{cs_event='checkout';cs_debug&&console.log('[CartStack] Core - Event: Cart/Checkout');if(eml!=''){for(var C=1,l=0;l<_cartstack.length;l++)
"setEmail"==_cartstack[l][0]&&(_cartstack[l][1]=eml,C=0);C&&_cartstack.push(["setEmail",eml]),cid!=''&&_cartstack.push(["setCartID",cid]);}else
cs_debug&&console.log('[CartStack] Core - No email found to track');if(cs_cartItems()>0||eml!=''){csAPICall('cart',function(json,httpcode){if(json!==false){for(var e=0;e<_cartstack.length;e++)"setCartID"==_cartstack[e][0]&&(_cartstack[e][1]=json.cartid);xe_createCookie('cartstack.com-cartid',json.cartid,365,true);json.email!=""&&cs_apiRequestData('strictcart','@');cs_debug&&console.log('[CartStack] Core - @csAPICall(cart), Strict: '+((json.email!=='')?'true':'false'));cs_debug&&alert(json.debug);}else
cs_debug&&console.log('[CartStack] Core - @csAPICall(cart), Cart API Failed!');});}else{cs_debug&&console.log('[CartStack] Core - @csAPICall(cart), Cart not sent... no products/email');}}}else cs_debug&&alert("Cookies not enabled!")}}
function cartstack_updatecart(t){if(xe_core.requireExtension('lgpd')&&!xe_core.callService('cookieConsent','MARKETING,EMAIL_MARKETING')){return false;}
var e=!1,a=0,r=0,o="",i=0,n=window.location.href;cs_debug&&console.log("[CartStack] Core - cartstack_updatecart();");(n.indexOf("cartstacktest=true")>-1)&&(i=1,t.push(["setShowAlert",1]),e=!0);for(var s=0;s<t.length;s++){var c=t[s][0],p=t[s][1];"setDomain"==c&&(o=p),"setAPI"==c&&"confirmation"==p&&(r=1),"setEmail"==c&&(a=1)}
if(0==o.length){var d=window.location.hostname,l=d.split(".");if(l.length>=3)
for(var s=1;s<l.length;s++)o=0==o.length?l[s]:o+"."+l[s];else o=l.length>=2?l[0]+"."+l[1]:l[0]}
if(navigator.cookieEnabled===!0){var m=cartstack_getCookie("cartstack.com-cartid=");var eml=xe_core.callService('visitorInfo').email;if(e&&alert('CartID from Cookie: "'+m+'"'),t.push(["setCartID",m]),a||(cartstack_update_email=eml,e&&alert('Email from Cookie: "'+cartstack_update_email+'"'),cartstack_update_email.length>0&&t.push(["setEmail",cartstack_update_email])),r){var h=new XMLHttpRequest;e&&alert("Confirmation!! -> "+u),h.open("GET",cs_api_urls.purchase+'?payload='+window.btoa(encodeURIComponent(JSON.stringify(t))),!0),h.onreadystatechange=function(){if(4==h.readyState&&200==h.status){xe_deleteCookie('cartstack.com-cartid');e&&alert("CartID Cookie erased!");cs_debug&&console.log('[CartStack] Core - @cartstack_updatecart, Real time purchase');}},h.send(null),e&&alert("Confirmation Sent to the server!")}else if(!cs_lgpdRestrict()){if(cs_cartItems()>0||eml!=''){t=cs_cartItemsLimit(t);var payload=window.btoa(encodeURIComponent(JSON.stringify(t)));if(cs_validRequest('cart_update',payload.length)){var h=new XMLHttpRequest;h.open("GET",cs_api_urls.cart_update+'?payload='+payload,!0),h.onreadystatechange=function(){if(4==h.readyState&&200==h.status){var t=JSON.parse(h.responseText);t.email!=""&&cs_apiRequestData('strictcart','@');cs_debug&&console.log('[CartStack] Core - @cartstack_updatecart, Real time cart! Strict: '+((t.email!="")?'true':'false'));xe_createCookie('cartstack.com-cartid',t.cartid,365,true);}},h.send(null)}else{cs_debug&&console.log('[CartStack] Core - @cartstack_updatecart, Request already sent!');}}else{cs_debug&&console.log('[CartStack] Core - @cartstack_updatecart, Cart not sent... no products/email');}}}else i&&alert("Cookies not enabled!")}
var cartstack_confirmation=cartstack_confirmation||0;